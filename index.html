<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Title of the document</title>
</head>
<body>
<script src="webgazer.js" type="text/javascript">
</script> 

<script>
window.onload = function(){
	webgazer.setRegression('ridge') /* currently must set regression and tracker */
    .setTracker('clmtrackr')
    .setGazeListener(function(data, elapsedTime) {
	    if (data == null) {
	       return;
	    }
	    var xprediction = data.x; //these x coordinates are relative to the viewport
	    var yprediction = data.y; //these y coordinates are relative to the viewport
	    document.getElementById("output").innerHTML = xprediction + " " + yprediction;
      document.cookie = "username=forest";

      //check to make sure that the dot will not draw over the video feed
      if(xprediction > 320 || yprediction > 240){
        var ctx = plotter.getContext("2d");
        ctx.beginPath();
        ctx.arc(xprediction,yprediction,5,0,2*Math.PI);
        ctx.fillStyle = 'green';
        ctx.fill();
        ctx.stroke();
      }

	}).begin();

	function setup_webgazer() {

      var width = 320;
      var height = 240;
      var topDist = '0px';
      var leftDist = '0px';

      var video = document.getElementById('webgazerVideoFeed');
      video.style.display = 'block';
      video.style.position = 'absolute';
      video.style.top = topDist;
      video.style.left = leftDist;
      video.width = width;
      video.height = height;
      video.style.margin = '0px';
      video.style.zIndex="-1";

      webgazer.params.imgWidth = width;
      webgazer.params.imgHeight = height;

      var overlay = document.createElement('canvas');
      overlay.id = 'overlay';
      overlay.style.position = 'absolute';
      overlay.width = width;
      overlay.height = height;
      overlay.style.top = topDist;
      overlay.style.left = leftDist;
      overlay.style.margin = '0px';

      document.body.appendChild(overlay);

      var cl = webgazer.getTracker().clm;

      function drawLoop() {
        requestAnimFrame(drawLoop);
        overlay.getContext('2d').clearRect(0,0,width,height);
        if (cl.getCurrentPosition()) {
          cl.draw(overlay);
        }
      }
      drawLoop();
    };

    function setup_plotter(){
      var width = window.innerWidth
      || document.documentElement.clientWidth
      || document.body.clientWidth;

      var height = window.innerHeight
      || document.documentElement.clientHeight
      || document.body.clientHeight;

      var topDist = '0px';
      var leftDist = '0px';

      var plotter = document.createElement('canvas');
      plotter.id = 'plotter';
      plotter.style.position = 'absolute';
      plotter.width = width;
      plotter.height = height;
      plotter.style.top = topDist;
      plotter.style.left = leftDist;
      plotter.style.margin = '0px';
      var ctx = plotter.getContext("2d");

      document.body.appendChild(plotter)

      //setup the listener for clearing the plotter
      document.addEventListener('keydown', function(event) {
      if(event.keyCode == 67) {
        var plotter = document.getElementById("plotter");
        var ctx = plotter.getContext("2d");
        ctx.fillStyle = "white";
        ctx.fillRect(320, 0, plotter.width, plotter.height);
        ctx.fillRect(0,240, plotter.width, plotter.height);
      }
      });

    }

    function checkIfReady() {
      if (webgazer.isReady()) {
        setup_webgazer();
        setup_plotter();
      } else {
        setTimeout(checkIfReady, 100);
      }
    }

    setTimeout(checkIfReady,100);

}
</script>
	
<table id = "output"> 
  <tr>
  <td> Results </td>
  <tr>
  <td>Nothing yet!</td> 
  </tr>
</table>
</body>

</html>